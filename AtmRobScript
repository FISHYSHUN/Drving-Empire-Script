--\\Variables//
local plr = game.Players.LocalPlayer
local PlrGui = plr.PlayerGui
local char = plr.Character or plr.CharacterAdded:Wait()
local camera = workspace.CurrentCamera
--\\//

--\\Values//
local deb = false
local tracking = true
local finding = false
--\\//

local ScreenUI = Instance.new("ScreenGui", PlrGui)
local NewButton = Instance.new("TextButton" , ScreenUI)
NewButton.Size = UDim2.new(0.15,0,0.15,0)
NewButton.Position = UDim2.new(.85,0,.85,0)
NewButton.Text = "Status: False"

--\\Functions//
local function CompleteProximity(proximityPrompt:ProximityPrompt)
	if not proximityPrompt then return warn("No prompt found") end
	proximityPrompt:InputHoldBegin()
	task.wait(proximityPrompt.HoldDuration + 0.15)
	proximityPrompt:InputHoldEnd()
end

function FindAtmSpawner()
	local spawnsTable = {}
	for _, v in workspace:GetDescendants() do
		if v:GetAttribute("ComponentServerId") and v.Name == "CriminalATMSpawner" then
			table.insert(spawnsTable, v)
		end
	end
	return spawnsTable
end

local function ChooseAtmSpawner()
	for _ , ATM:BasePart in workspace:GetDescendants() do
		if ATM:GetAttribute("ComponentServerId") and ATM.Name == "CriminalATMSpawner" then
			local CrimATM = ATM:FindFirstChild("CriminalATM")
			if CrimATM and CrimATM:GetAttribute("State") ~= "Busted" then
				return CrimATM
			end
		end
	end

end

function LoadAtm()
	if finding then
		local spawnsTable = FindAtmSpawner()
		if spawnsTable then
			local IndexMin = math.min(4, #spawnsTable)
			for i = 1, IndexMin do
				char:PivotTo(spawnsTable[i].CFrame * CFrame.new(0,2,0))
				task.wait(.125)
				if i == IndexMin then
					finding = false
					tracking = true
				end
			end
		else
			finding = false
			tracking = true
		end
	end
end

function CameraFollow(Attachment)
	camera.CameraSubject = Attachment
	camera.CameraType = Enum.CameraType.Scriptable
	camera.CFrame = Attachment.WorldCFrame * CFrame.new(0,4,-1) * CFrame.Angles(math.rad(-90),0,0)
end

function CameraReset()
	camera.CameraSubject = char:FindFirstChild("Humanoid")
	camera.CameraType = Enum.CameraType.Custom
end

function RobATM()
	if tracking then
		local ATM = ChooseAtmSpawner()
		if ATM then
			local Attachment = ATM:FindFirstChild("Attachment")
			local Prompt = Attachment:FindFirstChild("ProximityPrompt")

			task.wait(.125)

			char:PivotTo(Attachment.WorldCFrame * CFrame.new(0,2,0))
			CameraFollow(Attachment)

			task.wait(.21)

			CompleteProximity(Prompt)
			CameraReset()

			tracking = false
			finding = true
		else
			tracking = false
			finding = true
		end
	end
end
--\\//

NewButton.Activated:Connect(function()
	if deb then
		deb = false
		NewButton.Text = "Status: "..tostring(deb)
	else
		deb = true
		NewButton.Text = "Status: "..tostring(deb)
	end
end)

while task.wait() do
	if deb then
		if not tracking then
			LoadAtm()
		elseif tracking then
			RobATM()
		end
	end
end
