--Services
local Runservice = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

--Variables
local player = game.Players.LocalPlayer
local Char = player.Character or player.CharacterAdded:Wait()
local Camera = workspace.CurrentCamera
--Values
local Debounce = false
local Tracking = false
local Switch = false

---

function FindAtmSpawner(descendants:Folder)
	for i, v in pairs(descendants:GetDescendants()) do
		if v:GetAttribute("ComponentServerId") and v.Name == "CriminalATMSpawner" then
			local ComponentServerId = v:GetAttribute("ComponentServerId")

			if ComponentServerId ~= nil then
				return v
			end
		end
	end
end

-- Function to trigger the prompt automatically
function autoTriggerPrompt(prompt:ProximityPrompt)
	if prompt and prompt:IsA("ProximityPrompt") then
		task.wait()
		-- Simulate the player starting the hold
		prompt:InputHoldBegin()
		-- Wait for the required hold duration
		task.wait(prompt.HoldDuration + 0.2)
		-- Simulate the player releasing the hold
		prompt:InputHoldEnd()
	else
		warn("ProximityPrompt not found or invalid.")
	end
end

function CameraFollow(Attachment)
	Camera.CameraSubject = Attachment
	Camera.CameraType = Enum.CameraType.Scriptable
	Camera.CFrame = Attachment.WorldCFrame * CFrame.new(0,4,-1) * CFrame.Angles(math.rad(-90),0,0)
end

local function SwitchSides(Char:Model)
	local Vectors = {
		Vector3.new(-88, 28, -152),
		Vector3.new(-1278, 17, 2851)
	}

	local ChosenVector = Vectors[math.random(1, #Vectors)]
	Char:MoveTo(ChosenVector)
end

for _, v in workspace:GetDescendants() do
	if v.Name == "071_GARDEN_CENTER" and v:IsA("Model") then
		v:Destroy()
	end
end

local ScreenUi = Instance.new("ScreenGui", player.PlayerGui)
local NewButton = Instance.new("TextButton", ScreenUi)
local ClaimButton = Instance.new("TextButton", ScreenUi)

NewButton.Size = UDim2.new(.1, 0, 0.05, 0)
NewButton.Position = UDim2.new(0, 0, .95, 0)
ClaimButton.Size = UDim2.new(.05, 0, 0.05, 0)
ClaimButton.Position = UDim2.new(0.1, 0, .95, 0)
ClaimButton.Text = "Claim Bounty"

NewButton.Activated:Connect(function()
	if not Debounce then
		Debounce = true
		NewButton.Text = "State: "..tostring(Debounce)
	else
		Debounce = false
		NewButton.Text = "State: "..tostring(Debounce)
		Camera.CameraSubject = player.Character.Humanoid
		Camera.CameraType = Enum.CameraType.Custom
	end
end)

ClaimButton.Activated:Connect(function()
	Char:MoveTo(Vector3.new(-2544, 15, 4030))
	Camera.CameraSubject = player.Character.Humanoid
	Camera.CameraType = Enum.CameraType.Custom
end)

Runservice.Heartbeat:Connect(function()
	if Debounce then
		local Character = player.Character
		local AtmSpawner = FindAtmSpawner(workspace)
		local CriminalATM = AtmSpawner:FindFirstChild("CriminalATM")
		
		if CriminalATM  and CriminalATM:GetAttribute("State") ~= "Busted" or CriminalATM ~= nil then
			if not Tracking then
				Tracking = true

				if CriminalATM then
					local Attachment = CriminalATM:FindFirstChild("Attachment")
					local Prompt = Attachment:FindFirstChild("ProximityPrompt")
					Character:PivotTo(Attachment.WorldCFrame)

					task.wait(.1)
					CameraFollow(Attachment)

					task.wait(.345)

					autoTriggerPrompt(Prompt)

					Camera.CameraSubject = player.Character.Humanoid
					Camera.CameraType = Enum.CameraType.Custom

					task.wait(0.3)
					Tracking = false
				else
					Tracking = false
				end
			end
			
			if not CriminalATM then
				if not Switch then
					Switch = true
					
					Char:PivotTo(AtmSpawner.CFrame)
					task.wait(1)
					Switch = true
				end
			end
			
		end
	end
end)

Runservice.Heartbeat:Connect(function()
	if Debounce then
		
		
		
	end
end)

--teleport to the atmspawnlocations continously and pause when finding one with an atm and not busted
