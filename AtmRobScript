--Services
local Runservice = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

--Variables
local player = game.Players.LocalPlayer
local Char = player.Character or player.CharacterAdded:Wait()
local Camera = workspace.CurrentCamera
--Values
local Tracking = false
local Switch = false

function FindAtm(descendants:Folder)
	for i, v in pairs(descendants:GetDescendants()) do
		if v:GetAttribute("State") then
			local State = v:GetAttribute("State")

			if State ~= "Busted" then
				return v
			end
		end
	end
end

-- Function to trigger the prompt automatically
function autoTriggerPrompt(prompt:ProximityPrompt)
	if prompt and prompt:IsA("ProximityPrompt") then
		task.wait()
		-- Simulate the player starting the hold
		prompt:InputHoldBegin()
		-- Wait for the required hold duration
		task.wait(prompt.HoldDuration + 0.2)
		-- Simulate the player releasing the hold
		prompt:InputHoldEnd()
	else
		warn("ProximityPrompt not found or invalid.")
	end
end

function CameraFollow(Attachment)
	Camera.CameraSubject = Attachment
	Camera.CameraType = Enum.CameraType.Scriptable
	Camera.CFrame = Attachment.WorldCFrame * CFrame.new(0,4,-1) * CFrame.Angles(math.rad(-90),0,0)
end

for _, v in workspace:GetDescendants() do
	if v.Name == "071_GARDEN_CENTER" and v:IsA("Model") then
		v:Destroy()
	end
end

function SwitchSides(Char:Model)
	local Vectors = {
		Vector3.new(-316.107,20,-1661.905),
		Vector3.new(99,35,1556)
	}

	local ChosenVector = Vectors[math.random(1, #Vectors)]
	Char:MoveTo(ChosenVector)
end

Runservice.Heartbeat:Connect(function()
	local Atm = FindAtm(workspace)
	
	if Atm and Atm:GetAttribute("State") ~= "Busted" then
		local Attachment = Atm.Attachment
		local Prompt = Attachment.ProximityPrompt
		
		if not Tracking then
			Tracking = true

			Char:PivotTo(Attachment.WorldCFrame)
			CameraFollow(Attachment)
			
			task.wait(.345)
			
			autoTriggerPrompt(Prompt)
			
			Camera.CameraSubject = player.Character.Humanoid
			Camera.CameraType = Enum.CameraType.Custom
			
			task.wait(.125)
			Tracking = false
		else
			Tracking = true
			SwitchSides(Char)
			Camera.CameraSubject = player.Character.Humanoid
			Camera.CameraType = Enum.CameraType.Custom
			
			task.wait(1)
			Tracking = false
		end
	end
end)
